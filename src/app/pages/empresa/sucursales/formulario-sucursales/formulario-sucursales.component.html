<div class="intermitente" *ngIf="this.items.length !== 0 && this.rutaActual[1] === 'mi-negocio'">
	<p-accordion styleClass="intermitente">
		<p-accordionTab header="CLICK AQUI PARA INSERCION DE DATOS INICALES">       
		   <div class="card">
			   <p-toast></p-toast>
			   <p-steps [model]="items" [readonly]="true"></p-steps>
		   </div>
		   <router-outlet></router-outlet>
		   <app-step-toolbar [items]="this.items"></app-step-toolbar>
		</p-accordionTab>
	</p-accordion>
</div>
<!-- <br>
<button *ngIf="this.rutaActual[1] !== 'gestion-de-empresa'" pButton pRipple label="Ir a Formulario de Clientes" 
        icon="pi pi-chevron" type="button" (click)="redirigir()">
</button> -->
<br>
<form (ngSubmit)="guardarSucursales()" [formGroup]="forma">
    <div class="p-fluid p-formgrid p-grid">
        <div class="p-field p-col-12 p-md-3">
            <label for="descripcion">Descripción</label>
            <span class=" p-input-icon-right">
                <input id="descripcion" type="text" pInputText formControlName="descripcion" 
                        [class.ng-invalid]="getNoValido('descripcion')" [class.ng-dirty]="getNoValido('descripcion')" 
                        (keyup)="verificaSucursales($event.target.value)">
                <i class="pi pi-spin pi-spinner" *ngIf="sucursalesExiste === 0" style="color:#f5df18"></i>
                <i class="pi pi-check" *ngIf="sucursalesExiste === 1" style="color:#36b61d"></i>
                <i class="pi pi-times" *ngIf="sucursalesExiste === 2" style="color:#d83131"></i>
                <i class="pi pi-file-o" *ngIf="sucursalesExiste === 3"></i>
                <small *ngIf="getNoValido('descripcion')" class="p-invalid">Este campo es obligatorio.</small>
            </span>
        </div>

        <div class="p-field p-col-12 p-md-3">
            <label for="cod_cia">Empresa</label>
            <p-dropdown inputId="cod_cia" [options]="empresas" [class.ng-invalid]="getNoValido('cod_cia')" 
                        [class.ng-dirty]="getNoValido('cod_cia')" name="cod_cia" formControlName="cod_cia"
                        placeholder="Escoje.." optionLabel="nombre" (onChange)="datosLocalidad($event)">
            </p-dropdown>
            <small *ngIf="getNoValido('cod_cia')" class="p-invalid">Este campo es obligatorio.</small>
        </div>
    </div>
    <p-panel header="Ubicación" [toggleable]="true">
        <div class="p-fluid p-formgrid p-grid">
    
            <div class="p-field p-col-12 p-md-3">
                <label for="id_pais">Pais</label>
                <p-dropdown input  [options]="paises" [class.ng-invalid]="getNoValido('id_pais')" 
                            [class.ng-dirty]="getNoValido('id_pais')" name="id_pais" formControlName="id_pais" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion" (onChange)="buscaRegion($event.value.id_pais)">
                </p-dropdown>
                <small *ngIf="getNoValido('id_pais')" class="p-invalid">Este campo es obligatorio.</small>
            </div>
<!-- 
            <div class="p-field p-col-12 p-md-3">
                <label for="id_zona">Zona</label>
                <p-dropdown input  [options]="paises" [class.ng-invalid]="getNoValido('id_zona')" 
                            [class.ng-dirty]="getNoValido('id_zona')" name="id_zona" formControlName="id_zona" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion" (onChange)="buscaRegion($event.value.id_zona)">
                </p-dropdown>
                <small *ngIf="getNoValido('id_zona')" class="p-invalid">Este campo es obligatorio.</small>
            </div> -->
            
            <div class="p-field p-col-12 p-md-3">
                <label for="id_region">Región</label>
                <p-dropdown input  [options]="regiones" [class.ng-invalid]="getNoValido('id_region')" (onChange)="buscaProvincia($event.value.id_region)"
                            [class.ng-dirty]="getNoValido('id_region')" name="id_region" formControlName="id_region" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion">
                </p-dropdown>
                <small *ngIf="getNoValido('id_region')" class="p-invalid">Este campo es obligatorio.</small>
            </div>

            <div class="p-field p-col-12 p-md-3">
                <label for="id_provincia">Provincia</label>
                <p-dropdown input  [options]="provincias" [class.ng-invalid]="getNoValido('id_provincia')" 
                            [class.ng-dirty]="getNoValido('id_provincia')" name="id_provincia" formControlName="id_provincia" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion" (onChange)="buscaMunicipio($event.value.id_provincia)">
                </p-dropdown>
                <small *ngIf="getNoValido('id_provincia')" class="p-invalid">Este campo es obligatorio.</small>
            </div>
                
            <div class="p-field p-col-12 p-md-3">
                <label for="id_municipio">Municipio</label>
                <p-dropdown input  [options]="municipios" [class.ng-invalid]="getNoValido('id_municipio')" 
                            [class.ng-dirty]="getNoValido('id_municipio')" name="id_municipio" formControlName="id_municipio" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion" (onChange)="buscaCiudad($event.value.id_municipio)">
                </p-dropdown>
                <small *ngIf="getNoValido('id_municipio')" class="p-invalid">Este campo es obligatorio.</small>
            </div>
    
            <div class="p-field p-col-12 p-md-3">
                <label for="id_ciudad">Ciudad</label>
                <p-dropdown input [options]="ciudades" [class.ng-invalid]="getNoValido('id_ciudad')" 
                            [class.ng-dirty]="getNoValido('id_ciudad')" name="id_ciudad" formControlName="id_ciudad" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion" (onChange)="buscaSector($event.value.id_ciudad)">
                </p-dropdown>
                <small *ngIf="getNoValido('id_ciudad')" class="p-invalid">Este campo es obligatorio.</small>
            </div>
    
            <div class="p-field p-col-12 p-md-3">
                <label for="id_sector">Sector</label>
                <p-dropdown input  [options]="sectores" [class.ng-invalid]="getNoValido('id_sector')" 
                            [class.ng-dirty]="getNoValido('id_sector')" name="id_sector" formControlName="id_sector" 
                            id="drop-down" placeholder="Escoje.." optionLabel="descripcion">
                </p-dropdown>
                <small *ngIf="getNoValido('id_sector')" class="p-invalid">Este campo es obligatorio.</small>
            </div>

            <div class="p-field p-col-12 p-md-3">
                <label for="calle">Calle</label>
                <input pInputText type="text" inputId="calle" mode="decimal" name="calle" formControlName="calle"
                [class.ng-invalid]="getNoValido('calle')" [class.ng-dirty]="getNoValido('calle')"/>
                <small *ngIf="getNoValido('calle')" class="p-invalid">Este campo es obligatorio.</small>
            </div>    
        </div>
    </p-panel>
    <br>
    <button *ngIf="!this.formSubmitted && this.guardar" pButton pRipple label="Guardar" icon="pi pi-save" type="submit"></button>
    <button *ngIf="!this.formSubmitted && this.actualizar" (click)="actualizarSucursales()" pButton pRipple label="Actualizar" icon="pi pi-user-edit" type="button" class="p-button-warning p-mr-2 p-mb-2"></button>
    <button *ngIf="!this.formSubmitted && this.actualizar" (click)="cancelar()" pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-secondary p-mr-2 p-mb-2"></button> 
</form>
<br>
<p-progressBar mode="indeterminate" *ngIf="this.formSubmitted"></p-progressBar>